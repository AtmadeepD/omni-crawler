{% extends "base.html" %}

{% block title %}Analytics - OmniCrawler{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col">
        <h1><i class="fas fa-chart-bar"></i> Analytics</h1>
        <p class="text-muted">Deep insights into your news aggregation data</p>
    </div>
</div>

<div class="row">
    <!-- Category Distribution -->
    <div class="col-lg-6 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-chart-pie"></i> Category Distribution
                </h5>
            </div>
            <div class="card-body">
                <div id="category-chart"></div>
            </div>
        </div>
    </div>

    <!-- Sentiment Analysis -->
    <div class="col-lg-6 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-smile"></i> Sentiment Analysis
                </h5>
            </div>
            <div class="card-body">
                <div id="sentiment-chart"></div>
            </div>
        </div>
    </div>

    <!-- Domain Performance -->
    <div class="col-12 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">
                    <i class="fas fa-globe"></i> Domain Performance
                </h5>
            </div>
            <div class="card-body">
                <div id="domain-chart"></div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    loadCategoryAnalytics();
    loadSentimentAnalytics();
    loadDomainAnalytics();
});

function loadCategoryAnalytics() {
    fetch('/api/analytics/categories')
        .then(response => response.json())
        .then(data => {
            Plotly.newPlot('category-chart', data.chart.data, data.chart.layout);
        })
        .catch(error => {
            console.error('Error loading category analytics:', error);
            document.getElementById('category-chart').innerHTML = 
                '<p class="text-muted">Error loading category data</p>';
        });
}

function loadSentimentAnalytics() {
    fetch('/api/analytics/sentiment')
        .then(response => response.json())
        .then(data => {
            Plotly.newPlot('sentiment-chart', data.chart.data, data.chart.layout);
        })
        .catch(error => {
            console.error('Error loading sentiment analytics:', error);
            document.getElementById('sentiment-chart').innerHTML = 
                '<p class="text-muted">Error loading sentiment data</p>';
        });
}

function loadDomainAnalytics() {
    fetch('/api/analytics/domains')
        .then(response => response.json())
        .then(data => {
            Plotly.newPlot('domain-chart', data.chart.data, data.chart.layout);
        })
        .catch(error => {
            console.error('Error loading domain analytics:', error);
            document.getElementById('domain-chart').innerHTML = 
                '<p class="text-muted">Error loading domain data</p>';
        });
}
</script>
{% endblock %}